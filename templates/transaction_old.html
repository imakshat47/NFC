<!DOCTYPE html>
<html lang="en" class="">
  <head>
    <meta charset="utf-8" />
    <meta name="referrer" content="origin" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="apple-itunes-app"
      content="app-id=458023433, app-argument=splitwise://open"
    />
    <meta
      name="description"
      content="NFC is a free tool for friends and roommates to track bills and other shared expenses, so that everyone gets paid back. On the web, iPhone, and Android!"
    />
    <meta name="color-scheme" content="light only" />

    <meta
      property="og:description"
      content="NFC is a free tool for friends and roommates to track bills and other shared expenses, so that everyone gets paid back. On the web, iPhone, and Android!"
    />
    <meta property="og:title" content="Log in" />
    <meta
      property="og:image"
      content="https://assets.splitwise.com/assets/core/open-graph-preview-c1b55b0dc7c2b2d5bd6f40bbe34989f3eb2317843246727606cf3e96ee254609.png"
    />
    <meta
      property="og:image:secure_url"
      content="https://assets.splitwise.com/assets/core/open-graph-preview-c1b55b0dc7c2b2d5bd6f40bbe34989f3eb2317843246727606cf3e96ee254609.png"
    />
    <meta property="og:image:alt" content="Splitwise logo" />
    <meta property="og:site_name" content="Splitwise" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://secure.splitwise.com/login" />
    <meta property="fb:app_id" content="293864780643203" />
    <meta property="og:locale" content="en" />
    <meta property="og:locale:alternate" content="de" />
    <meta property="og:locale:alternate" content="es" />
    <meta property="og:locale:alternate" content="fr" />
    <meta property="og:locale:alternate" content="id" />
    <meta property="og:locale:alternate" content="it" />
    <meta property="og:locale:alternate" content="ja" />
    <meta property="og:locale:alternate" content="nl" />
    <meta property="og:locale:alternate" content="pt-BR" />
    <meta property="og:locale:alternate" content="pt-PT" />
    <meta property="og:locale:alternate" content="sv" />
    <meta property="og:locale:alternate" content="th" />
    <meta property="og:locale:alternate" content="emoji" />

    <meta name="twitter:card" content="app" />
    <meta
      name="twitter:description"
      content="Splitwise is a free tool for friends and roommates to track bills and other shared expenses, so that everyone gets paid back. On the web, iPhone, and Android!"
    />
    <meta name="twitter:site" content="@splitwise" />
    <meta name="twitter:app:name:iphone" content="Splitwise" />
    <meta name="twitter:app:id:iphone" content="458023433" />
    <meta name="twitter:app:name:googleplay" content="Splitwise" />
    <meta
      name="twitter:app:id:googleplay"
      content="com.Splitwise.SplitwiseMobile"
    />

    <meta name="csrf-param" content="authenticity_token" />
    <meta
      name="csrf-token"
      content="Pejp1c-ddlc7xQ_gwYW0mwT62AwZKppr1xvsldRS7tXgk_zdMzCG1x1ou7ECKrzY-sVFqwu-6Wy4AL7aSv9J1Q"
    />

    <link
      rel="stylesheet"
      href="https://assets.splitwise.com/assets/motel-82ff5aea486b5a67c66619aefa9df389a82561c946813551bfee5ed0175bf3a8.css"
      media="all"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:400,400i,700|Montserrat:400,600,700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link
      rel="apple-touch-icon-precomposed"
      href="/apple-touch-icon-precomposed.png"
    />

    <link rel="canonical" href="https://www.splitwise.com/login" />

    <script type="importmap" data-turbo-track="reload">
      {
        "imports": {
          "application": "https://assets.splitwise.com/assets/application-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js",
          "motel": "https://assets.splitwise.com/assets/motel-9680a85d72b6e12cc54519efa8506651b42f5a043ce30bc3c73bf48ba8af53a7.js",
          "motel/motel": "https://assets.splitwise.com/assets/motel/motel-c75db22451adcb1f5d0420f4cad79acafbb541772a3771da2be4cca996d1fd6d.js",
          "charts": "https://assets.splitwise.com/assets/charts-1f38e9276acc590cf23ffc67fb3514a8af03f73a7a02a68981883c97934a1d9f.js",
          "chartkick": "https://assets.splitwise.com/assets/chartkick-338375253bd80b2f0da7e8b98ae0194bb84ea647cae7d3a2fec94a8cc15f7578.js",
          "Chart.bundle": "https://assets.splitwise.com/assets/Chart.bundle-93c2270a882e090c5eaceec7a74e8cc7c4e02f7dde0951148b83f9a0be5c8dbb.js",
          "@rails/ujs": "https://assets.splitwise.com/assets/@rails--ujs-57169a955c1531a628bf30afac33de3edd70cec551c6262363e9915d750c3f6d.js",
          "@github/webauthn-json/browser-ponyfill": "https://assets.splitwise.com/assets/@github--webauthn-json--browser-ponyfill-c940892aa19f632b24b0ce6709282eceeed185222b9fda7902b0ec9bd72ce954.js"
        }
      }
    </script>

    <script
      src="https://assets.splitwise.com/assets/es-module-shims.min-f6e61a1a9f41be4f7947efa52fef6f0b9b265d4a397ce46d39a09e1c1d044578.js"
      async="async"
      data-turbo-track="reload"
    ></script>
    <script type="module">
      import "application";
    </script>
    <script type="module">
      import "motel";
    </script>
    <style>
      .dashboard {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: hsl(120, 67%, 96%);
        border-radius: 10px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
        padding: 20px;
        max-width: 800px;
        width: 90%;
        margin: 20px auto;
      }

      .circle {
        background-color: hsl(122, 47%, 71%);
        border-radius: 50%;
        width: 200px;
        height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin-bottom: 20px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
      }

      .circle h2 {
        margin: 0;
        font-size: 1.2rem;
      }

      .circle h1 {
        margin: 5px 0;
        font-size: 2.5rem;
      }

      .circle p {
        margin: 0;
        font-size: 1rem;
      }

      .info {
        width: 100%;
        text-align: left;
      }

      .title {
        margin: 0 0 10px;
        font-size: 2rem;
        font-weight: bold;
      }

      .info p {
        margin: 5px 0;
        font-size: 1rem;
      }

      .info p span {
        font-weight: bold;
      }

      .note {
        margin-top: 10px;
        font-size: 1rem;
        font-weight: bold;
        color: #e8f5e9;
      }

      .buttons {
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        gap: 10px;
      }

      .btn {
        border: none;
        padding: 10px 20px;
        font-size: 1rem;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background-color: #2e7d32;
        color: #fff;
      }

      .btn-primary:hover {
        background-color: #1b5e20;
      }

      .btn-secondary {
        background-color: #ffffff;
        color: #4caf50;
      }

      .btn-secondary:hover {
        background-color: #f1f1f1;
      }

      .table {
            border-collapse: collapse !important;
        }
        .table th {
            background-color: #212529 !important;
            color: #ffffff !important;
            text-align: center !important;
        }
        .table td {
            text-align: center !important;
        }
        .table tbody tr:hover {
            background-color: #f1f3f5 !important;
        }
        .table tbody tr:nth-child(even) {
            background-color: #f8f9fa !important;
        }
        .btn-refresh {
            display: inline-block;
            margin: 20px auto;
            text-align: center;
            cursor: pointer;
        }
        .btn-refresh button {
            background-color: #198754;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 16px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        .btn-refresh button:hover {
            background-color: #157347;
            color: #ffffff;
        }
    </style>
  </head>
  <body class="font-sans subpixel-antialiased login">
    <!-- Outer Container -->
    <div class="container mx-auto">
      <!-- Include Header -->
      {% include 'header_login.html' %}
    </div>

    <main class="bg-facets">
      <!-- Main Content Container -->
      <div class="container mx-auto px-4 md:px-8 pt-8">
        <!-- Flex Wrapper for Center Alignment -->
        <div class="lg:flex lg:items-center lg:justify-center">
          <!-- Modal Box Wrapper -->
          <div class="lg:w-2/3 xl:w-2/3 dashboard">
            <div class="title">
              <h3 class="title">Transaction Management</h3>
            </div>
            
            <!-- Tab Navigation for Create/Approve -->
            <div class="buttons">
              <button class="btn btn-primary"  id="create-tab" onclick="showTab('createTransaction')">Create Transaction</button>
              <button class="btn btn-secondary" id="approve-tab" onclick="showTab('approveTransaction')">Approve Transactions</button>
            </div>
            
            <!-- Create Transaction Form -->
            <div id="createTransaction" style="display:block;height: fit-content;">
              <br>
              <h4>Create Transaction</h4>
              <br>
              <form>
                <div class="mb-10"style="display:block;max-width;">
                  <h4><label for="amount" class="form-label">Amount</label>
                    <input type="number" class="form-control" id="amount" placeholder="Enter the amount"></h4>
                </div><br>
               
                <div class="mb-10"style="display:block;max-width;">
                  <h4><label for="to" class="form-label">To</label>
                  <select class="form-select" id="to" required></select></h4>
                </div>
                <br>
                <div class="mb-10">
                  <h4><label for="type" class="form-label">Type</label>
                    <select class="form-select" id="type" required>
                      <option value="Lend">Lend</option>
                      <option value="Borrow">Borrow</option>
                    </select></h4>
                    <br>
               
                </div>
                <button type="button" class="btn btn-primary" onclick="createTransaction()">Create Transaction</button>
              </form>
            </div>
      
            <!-- Approve Transactions -->
            <div id="approveTransaction" style="display:none;">
              <h4>Approve Transactions</h4>
              <div class="table-container">
                <table class="table table-bordered table-hover">
                  <thead>
                    <tr>
                      <th>Transaction ID</th>
                      <th>Amount</th>
                      <th>Type</th>
                      <th>Date</th>
                      <th>From</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="approval-transactions">
                    <!-- Rows will be dynamically inserted here -->
                  </tbody>
                </table>
              </div>
              <div class="btn-refresh">
                <button onclick="fetchApprovalTransactions()"><i class="fas fa-sync-alt"></i> Refresh</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </main>

    <!-- Footer Section -->
    <div class="container mx-auto mt-8">{% include 'footer.html' %}</div>
<script>
        function showTab(tabId) {
            // document.getElementById('createTransaction').style.display = tabId === 'createTransaction' ? 'block' : 'none';
            // document.getElementById('approveTransaction').style.display = tabId === 'approveTransaction' ? 'block' : 'none';
            document.getElementById('create-tab').classList.remove('btn-primary');
    document.getElementById('create-tab').classList.add('btn-secondary');
    
    document.getElementById('approve-tab').classList.remove('btn-primary');
    document.getElementById('approve-tab').classList.add('btn-secondary');
    
    // Hide all content sections
    document.getElementById('createTransaction').style.display = 'none';
    document.getElementById('approveTransaction').style.display = 'none';

    // Show the selected tab and set the button to primary
    if (tabId === 'createTransaction') {
      document.getElementById('createTransaction').style.display = 'block';
      document.getElementById('create-tab').classList.remove('btn-secondary');
      document.getElementById('create-tab').classList.add('btn-primary');
    } else {
      document.getElementById('approveTransaction').style.display = 'block';
      document.getElementById('approve-tab').classList.remove('btn-secondary');
      document.getElementById('approve-tab').classList.add('btn-primary');
    }
        }

        function loadUsers() {
            fetch('/getUsers')
                .then(response => response.json())
                .then(users => {
                    const toSelect = document.getElementById('to');
                    users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.user_id;
                        option.textContent = `${user.fullname} (${user.username})`;
                        toSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching users:', error));
        }

        function createTransaction() {
            const amount = document.getElementById('amount').value;
            const approval = document.getElementById('to').value;
            const type = document.getElementById('type').value;

            fetch('/createTransaction', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ amount, approval, type }),
            })
                .then(response => response.json())
                .then(data => alert(data.message))
                .catch(error => console.error('Error creating transaction:', error));
        }

        function fetchApprovalTransactions() {
            fetch('/getApprovalTransactions')
                .then(response => response.json())
                .then(transactions => {
                    const tableBody = document.getElementById('approval-transactions');
                    tableBody.innerHTML = '';
                    transactions.forEach(transaction => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${transaction.transaction_id}</td>
                            <td>${transaction.amount}</td>
                            <td>${transaction.type}</td>
                            <td>${transaction.created_at}</td>
                            <td>${transaction.from_user_name}</td>
                            <td><button class="btn btn-success" onclick="approveTransaction('${transaction.transaction_id}', this)">Approve</button></td>
                        `;
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching approval transactions:', error));
        }

        function approveTransaction(transactionId, button) {
    fetch('/approveTransaction', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ transaction_id: transactionId }),
    })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            // Remove the transaction row from the table
            button.closest('tr').remove();
        })
        .catch(error => console.error('Error approving transaction:', error));
}
        document.addEventListener('DOMContentLoaded', () => {
            loadUsers();
            fetchApprovalTransactions();
        });
    </script>
  </body>
</html>

    